<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grynx Store ‚Äî Mini App</title>
  <style>
    :root{--bg:#0f1720;--card:#111827;--accent:#2b6ef6;--muted:#9ca3af;--white:#e6eef8}
    body{margin:0;background:linear-gradient(180deg,#071019 0%, #0f1720 100%);font-family:Inter,Segoe UI,Arial;color:var(--white)}
    header{padding:18px 16px;display:flex;align-items:center;gap:12px}
    .logo{font-weight:700;font-size:18px}
    .container{padding:8px 12px 80px}
    .carousel{height:140px;background:linear-gradient(90deg,#1f2937,#111827);border-radius:12px;display:flex;align-items:center;justify-content:center;color:var(--muted);margin-bottom:14px}
    .section-title{font-weight:600;margin:8px 4px;color:#fff}
    .grid{display:flex;gap:10px;flex-wrap:wrap}
    .icon-card{width:80px;height:80px;border-radius:14px;background:var(--card);display:flex;align-items:center;justify-content:center;flex-direction:column;color:var(--muted)}
    .product-card{width:calc(50% - 8px);background:var(--card);border-radius:12px;padding:12px;margin-top:12px}
    .product-title{font-weight:600;margin-bottom:6px}
    .price{color:var(--accent);font-weight:700}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:#fff;text-decoration:none;margin-top:10px}
    .cart-btn{position:fixed;left:12px;bottom:12px;padding:10px 12px;border-radius:12px;background:#0ea5a5;color:#001}
    .bottom-bar{position:fixed;left:0;right:0;bottom:0;background:rgba(0,0,0,0.35);padding:10px 12px;text-align:center;color:var(--muted)}
    .cart-list{background:var(--card);padding:10px;border-radius:10px;margin-top:10px}
  </style>
</head>
<body>
  <header>
    <div class="logo">Grynx Store</div>
  </header>

  <div class="container">
    <div class="carousel">Banner / Carousel ‚Äî Telegram Stars</div>

    <div class="section-title">–ì–ª–∞–≤–Ω–∞—è</div>
    <div class="grid" id="icons">
      <!-- icon tiles like on screenshot -->
    </div>

    <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
    <div id="products" class="grid">
      <!-- product cards rendered by JS -->
    </div>

    <div id="cart" style="display:none">
      <div class="section-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
      <div class="cart-list" id="cart-list"></div>
      <div style="margin-top:8px;">
        <button id="checkout" class="btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>
  </div>

  <button class="cart-btn" id="toggle-cart">–ö–æ—Ä–∑–∏–Ω–∞ üõí (<span id="cart-count">0</span>)</button>
  <div class="bottom-bar">@GrynxStoreBot</div>

  <script>
    // –ü—Ä–∏–º–µ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ (–≤ —Ä–µ–∞–ª–µ ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å —Å–µ—Ä–≤–µ—Ä–∞)
    const PRODUCTS = [
      {id:1, title:"5000 –æ—á–∫–æ–≤ Steam", price:70, currency:"‚Ç¥"},
      {id:2, title:"50 Telegram Stars", price:45, currency:"‚Ç¥"},
      {id:3, title:"Standoff-2 1000 coins", price:120, currency:"‚Ç¥"},
      {id:4, title:"War Thunder Bundle", price:90, currency:"‚Ç¥"}
    ];

    const cart = [];

    function renderIcons(){
      const icons = document.getElementById("icons");
      const names = ["Standoff-2","War Thunder","Steam","Telegram"];
      names.forEach(n=>{
        const el = document.createElement("div");
        el.className = "icon-card";
        el.innerHTML = `<div style="font-size:13px">${n}</div>`;
        icons.appendChild(el);
      });
    }

    function renderProducts(){
      const box = document.getElementById("products");
      PRODUCTS.forEach(p=>{
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <div class="product-title">${p.title}</div>
          <div>${p.description || ""}</div>
          <div class="price">${p.price} ${p.currency}</div>
          <button class="btn" onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        `;
        box.appendChild(card);
      });
    }

    function addToCart(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      const ex = cart.find(x=>x.id===id);
      if(ex) ex.qty++;
      else cart.push({id:p.id, title:p.title, price:p.price, qty:1});
      updateCartUI();
    }

    function updateCartUI(){
      const cnt = cart.reduce((s,i)=>s+i.qty,0);
      document.getElementById("cart-count").innerText = cnt;
      const list = document.getElementById("cart-list");
      list.innerHTML = "";
      if(cart.length===0) list.innerHTML = "<div style='color:#9ca3af'>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>";
      else {
        cart.forEach(it=>{
          const row = document.createElement("div");
          row.style.marginBottom="8px";
          row.innerHTML = `${it.title} ‚Äî ${it.qty} √ó ${it.price} = ${it.qty * it.price}`;
          list.appendChild(row);
        });
      }
    }

    document.getElementById("toggle-cart").addEventListener("click", ()=>{
      const el = document.getElementById("cart");
      el.style.display = (el.style.display==="none" || el.style.display==="") ? "block" : "none";
    });

    document.getElementById("checkout").addEventListener("click", async ()=>{
      if(cart.length===0){ alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞"); return; }
      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ Telegram)
      const tg = window.Telegram?.WebApp;
      let user_id = null;
      let user_name = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
      if(tg && tg.initDataUnsafe && tg.initDataUnsafe.user){
        user_id = tg.initDataUnsafe.user.id;
        user_name = tg.initDataUnsafe.user.first_name || user_name;
      } else {
        // –µ—Å–ª–∏ –Ω–µ –≤–Ω—É—Ç—Ä–∏ Telegram ‚Äî –ø–æ–ø—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ id (–¥–ª—è —Ç–µ—Å—Ç–∞)
        user_id = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID –¥–ª—è —Ç–µ—Å—Ç–∞ (user_id):");
        if(!user_id) return;
      }

      const total = cart.reduce((s,i)=>s + i.qty * i.price, 0);
      const payload = { user_id: Number(user_id), user_name, items: cart, total };

      try {
        const resp = await fetch("/api/order", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await resp.json();
        if(data.ok){
          alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –°–ø–∞—Å–∏–±–æ.");
          // –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ WebApp, –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å
          if(window.Telegram?.WebApp) window.Telegram.WebApp.close();
          cart.length = 0;
          updateCartUI();
        } else {
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞: " + JSON.stringify(data));
        }
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err);
      }
    });

    // init
    renderIcons();
    renderProducts();
    updateCartUI();
  </script>
</body>
</html>